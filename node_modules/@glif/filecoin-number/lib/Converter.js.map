{"version":3,"sources":["../src/Converter.ts"],"names":["bent","BigNumber","FilecoinNumber","Converter","currency","options","Error","apiKey","apiURL","rate","convert","amount","toFIL","filAmount","dividedBy","fromFIL","multipliedBy","from","to","get","res","data","quote","price"],"mappings":"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","sourcesContent":["import bent from 'bent'\nimport { BigNumber } from 'bignumber.js'\nimport { FilecoinNumber } from './FilecoinNumber'\n\nexport type ConverterOptions = {\n  apiKey?: string\n  apiURL?: string\n}\n\nexport class Converter {\n  readonly currency: string\n  readonly apiKey: string\n  readonly apiURL: string\n  rate: BigNumber | null\n\n  constructor(currency: string, options?: ConverterOptions) {\n    if (!currency) throw new Error('No currency passed.')\n    this.currency = currency\n    this.apiKey = options?.apiKey || ''\n    this.apiURL = options?.apiURL || 'https://pro-api.coinmarketcap.com/'\n    this.rate = null\n  }\n\n  async cacheConversionRate() {\n    this.rate = new BigNumber(await this.convert(1, 'FIL', this.currency))\n  }\n\n  toFIL(amount: string | number | BigNumber): FilecoinNumber {\n    if (!amount) return this.toFIL('0')\n    if (!this.rate) {\n      throw new Error(\n        'Call cacheConversionRate() to get the conversion rate before calling .toFIL.',\n      )\n    }\n    if (\n      typeof amount === 'string' ||\n      typeof amount === 'number' ||\n      amount instanceof BigNumber\n    ) {\n      const filAmount = new BigNumber(amount).dividedBy(this.rate)\n      return new FilecoinNumber(filAmount, 'fil')\n    }\n\n    throw new Error(\n      'Amount passed must be a Number, String, or an instanceof BigNumber',\n    )\n  }\n\n  fromFIL(amount: string | number | BigNumber | FilecoinNumber): BigNumber {\n    if (!amount) return this.fromFIL('0')\n    if (!this.rate)\n      throw new Error(\n        'Call cacheConversionRate() to get the conversion rate before calling .fromFIL.',\n      )\n\n    if (\n      typeof amount === 'string' ||\n      typeof amount === 'number' ||\n      amount instanceof BigNumber\n    ) {\n      return new BigNumber(amount).multipliedBy(this.rate)\n    }\n\n    throw new Error(\n      'Amount passed must be a Number, String, or an instanceof BigNumber.',\n    )\n  }\n\n  async convert(amount: number, from: string, to: string): Promise<string> {\n    const get = bent('GET', 'json', {\n      'X-CMC_PRO_API_KEY': this.apiKey,\n    })\n\n    const res = await get(\n      `${this.apiURL}/v1/tools/price-conversion?symbol=${from}&amount=${amount}&convert=${to}`,\n    )\n\n    if (!res.data || !res.data.quote || !res.data.quote[to])\n      throw new Error('No conversion price found.')\n\n    return res.data.quote[to].price\n  }\n\n  getCachedConversionRate() {\n    return this.rate\n  }\n}\n"],"file":"Converter.js"}