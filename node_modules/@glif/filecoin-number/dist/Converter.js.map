{"version":3,"sources":["../src/Converter.ts"],"names":["Converter","currency","options","Error","apiKey","apiURL","rate","BigNumber","convert","amount","toFIL","filAmount","dividedBy","FilecoinNumber","fromFIL","multipliedBy","from","to","get","res","data","quote","price"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;IAOaA,S;AAMX,qBAAYC,QAAZ,EAA8BC,OAA9B,EAA0D;AAAA;AAAA;AAAA;AAAA;AAAA;AACxD,QAAI,CAACD,QAAL,EAAe,MAAM,IAAIE,KAAJ,CAAU,qBAAV,CAAN;AACf,SAAKF,QAAL,GAAgBA,QAAhB;AACA,SAAKG,MAAL,GAAc,CAAAF,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEE,MAAT,KAAmB,EAAjC;AACA,SAAKC,MAAL,GAAc,CAAAH,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEG,MAAT,KAAmB,oCAAjC;AACA,SAAKC,IAAL,GAAY,IAAZ;AACD;;;;;;;;;;8BAGiBC,oB;;uBAAgB,KAAKC,OAAL,CAAa,CAAb,EAAgB,KAAhB,EAAuB,KAAKP,QAA5B,C;;;;AAAhC,qBAAKK,I;;;;;;;;;;;;;;;;;;0BAGDG,M,EAAqD;AACzD,UAAI,CAACA,MAAL,EAAa,OAAO,KAAKC,KAAL,CAAW,GAAX,CAAP;;AACb,UAAI,CAAC,KAAKJ,IAAV,EAAgB;AACd,cAAM,IAAIH,KAAJ,CACJ,8EADI,CAAN;AAGD;;AACD,UACE,OAAOM,MAAP,KAAkB,QAAlB,IACA,OAAOA,MAAP,KAAkB,QADlB,IAEAA,MAAM,YAAYF,oBAHpB,EAIE;AACA,YAAMI,SAAS,GAAG,IAAIJ,oBAAJ,CAAcE,MAAd,EAAsBG,SAAtB,CAAgC,KAAKN,IAArC,CAAlB;AACA,eAAO,IAAIO,8BAAJ,CAAmBF,SAAnB,EAA8B,KAA9B,CAAP;AACD;;AAED,YAAM,IAAIR,KAAJ,CACJ,oEADI,CAAN;AAGD;;;4BAEOM,M,EAAiE;AACvE,UAAI,CAACA,MAAL,EAAa,OAAO,KAAKK,OAAL,CAAa,GAAb,CAAP;AACb,UAAI,CAAC,KAAKR,IAAV,EACE,MAAM,IAAIH,KAAJ,CACJ,gFADI,CAAN;;AAIF,UACE,OAAOM,MAAP,KAAkB,QAAlB,IACA,OAAOA,MAAP,KAAkB,QADlB,IAEAA,MAAM,YAAYF,oBAHpB,EAIE;AACA,eAAO,IAAIA,oBAAJ,CAAcE,MAAd,EAAsBM,YAAtB,CAAmC,KAAKT,IAAxC,CAAP;AACD;;AAED,YAAM,IAAIH,KAAJ,CACJ,qEADI,CAAN;AAGD;;;;qHAEaM,M,EAAgBO,I,EAAcC,E;;;;;;AACpCC,gBAAAA,G,GAAM,sBAAK,KAAL,EAAY,MAAZ,EAAoB;AAC9B,uCAAqB,KAAKd;AADI,iBAApB,C;;uBAIMc,GAAG,WAChB,KAAKb,MADW,+CACgCW,IADhC,qBAC+CP,MAD/C,sBACiEQ,EADjE,E;;;AAAfE,gBAAAA,G;;sBAIF,CAACA,GAAG,CAACC,IAAL,IAAa,CAACD,GAAG,CAACC,IAAJ,CAASC,KAAvB,IAAgC,CAACF,GAAG,CAACC,IAAJ,CAASC,KAAT,CAAeJ,EAAf,C;;;;;sBAC7B,IAAId,KAAJ,CAAU,4BAAV,C;;;kDAEDgB,GAAG,CAACC,IAAJ,CAASC,KAAT,CAAeJ,EAAf,EAAmBK,K;;;;;;;;;;;;;;;;;;8CAGF;AACxB,aAAO,KAAKhB,IAAZ;AACD","sourcesContent":["import bent from 'bent'\nimport { BigNumber } from 'bignumber.js'\nimport { FilecoinNumber } from './FilecoinNumber'\n\nexport type ConverterOptions = {\n  apiKey?: string\n  apiURL?: string\n}\n\nexport class Converter {\n  readonly currency: string\n  readonly apiKey: string\n  readonly apiURL: string\n  rate: BigNumber | null\n\n  constructor(currency: string, options?: ConverterOptions) {\n    if (!currency) throw new Error('No currency passed.')\n    this.currency = currency\n    this.apiKey = options?.apiKey || ''\n    this.apiURL = options?.apiURL || 'https://pro-api.coinmarketcap.com/'\n    this.rate = null\n  }\n\n  async cacheConversionRate() {\n    this.rate = new BigNumber(await this.convert(1, 'FIL', this.currency))\n  }\n\n  toFIL(amount: string | number | BigNumber): FilecoinNumber {\n    if (!amount) return this.toFIL('0')\n    if (!this.rate) {\n      throw new Error(\n        'Call cacheConversionRate() to get the conversion rate before calling .toFIL.',\n      )\n    }\n    if (\n      typeof amount === 'string' ||\n      typeof amount === 'number' ||\n      amount instanceof BigNumber\n    ) {\n      const filAmount = new BigNumber(amount).dividedBy(this.rate)\n      return new FilecoinNumber(filAmount, 'fil')\n    }\n\n    throw new Error(\n      'Amount passed must be a Number, String, or an instanceof BigNumber',\n    )\n  }\n\n  fromFIL(amount: string | number | BigNumber | FilecoinNumber): BigNumber {\n    if (!amount) return this.fromFIL('0')\n    if (!this.rate)\n      throw new Error(\n        'Call cacheConversionRate() to get the conversion rate before calling .fromFIL.',\n      )\n\n    if (\n      typeof amount === 'string' ||\n      typeof amount === 'number' ||\n      amount instanceof BigNumber\n    ) {\n      return new BigNumber(amount).multipliedBy(this.rate)\n    }\n\n    throw new Error(\n      'Amount passed must be a Number, String, or an instanceof BigNumber.',\n    )\n  }\n\n  async convert(amount: number, from: string, to: string): Promise<string> {\n    const get = bent('GET', 'json', {\n      'X-CMC_PRO_API_KEY': this.apiKey,\n    })\n\n    const res = await get(\n      `${this.apiURL}/v1/tools/price-conversion?symbol=${from}&amount=${amount}&convert=${to}`,\n    )\n\n    if (!res.data || !res.data.quote || !res.data.quote[to])\n      throw new Error('No conversion price found.')\n\n    return res.data.quote[to].price\n  }\n\n  getCachedConversionRate() {\n    return this.rate\n  }\n}\n"],"file":"Converter.js"}