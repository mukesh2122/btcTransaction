import { extractError } from "../lib/retry";
// import { List } from "immutable";
export const testEndpoints = async (t, endpoints, expectedError) => {
    let expectedResult = null;
    for (let i = 0; i < endpoints.length; i++) {
        const endpoint = endpoints[i];
        if (!endpoint) {
            continue;
        }
        try {
            const result = await endpoint();
            // console.log("result", result);
            // try {
            //     if (Array.isArray(result)) {
            //         result = List(result).sortBy(x => x.txid).toArray();
            //     }
            // } catch (error: any) {
            //     // ignore error
            // }
            expectedResult = expectedResult || result;
            t.deepEqual(result, expectedResult, `Comparison failed for endpoint #${i}`);
        }
        catch (error) {
            // tslint:disable-next-line: no-object-mutation
            error.message = extractError(error);
            if (expectedError &&
                // Check if error message matches expected error
                ((error.message && error.message.match(expectedError)) ||
                    // Check if request URL matches expected error
                    (error.response &&
                        error.config &&
                        typeof error.response.config.url === "string" &&
                        error.response.config.url.match(expectedError)))) {
                continue;
            }
            console.log("error.response.data", error.response && error.response.data);
            // if (error.message.match(/Request failed with status code 503/)) {
            //     continue;
            // }
            throw error;
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BlY1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NwZWMvc3BlY1V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFNUMsb0NBQW9DO0FBRXBDLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxLQUFLLEVBQzlCLENBQTRCLEVBQzVCLFNBQTBELEVBQzFELGFBQXNCLEVBQ3hCLEVBQUU7SUFDQSxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUM7SUFDMUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDdkMsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDWCxTQUFTO1NBQ1o7UUFDRCxJQUFJO1lBQ0EsTUFBTSxNQUFNLEdBQUcsTUFBTSxRQUFRLEVBQUUsQ0FBQztZQUNoQyxpQ0FBaUM7WUFDakMsUUFBUTtZQUNSLG1DQUFtQztZQUNuQywrREFBK0Q7WUFDL0QsUUFBUTtZQUNSLHlCQUF5QjtZQUN6QixzQkFBc0I7WUFDdEIsSUFBSTtZQUNKLGNBQWMsR0FBRyxjQUFjLElBQUksTUFBTSxDQUFDO1lBQzFDLENBQUMsQ0FBQyxTQUFTLENBQ1AsTUFBTSxFQUNOLGNBQWMsRUFDZCxtQ0FBbUMsQ0FBQyxFQUFFLENBQ3pDLENBQUM7U0FDTDtRQUFDLE9BQU8sS0FBVSxFQUFFO1lBQ2pCLCtDQUErQztZQUMvQyxLQUFLLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNwQyxJQUNJLGFBQWE7Z0JBQ2IsZ0RBQWdEO2dCQUNoRCxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztvQkFDbEQsOENBQThDO29CQUM5QyxDQUFDLEtBQUssQ0FBQyxRQUFRO3dCQUNYLEtBQUssQ0FBQyxNQUFNO3dCQUNaLE9BQU8sS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxLQUFLLFFBQVE7d0JBQzdDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUMxRDtnQkFDRSxTQUFTO2FBQ1o7WUFDRCxPQUFPLENBQUMsR0FBRyxDQUNQLHFCQUFxQixFQUNyQixLQUFLLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUN4QyxDQUFDO1lBQ0Ysb0VBQW9FO1lBQ3BFLGdCQUFnQjtZQUNoQixJQUFJO1lBQ0osTUFBTSxLQUFLLENBQUM7U0FDZjtLQUNKO0FBQ0wsQ0FBQyxDQUFDIn0=