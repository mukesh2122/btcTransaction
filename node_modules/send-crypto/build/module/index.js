import BigNumber from "bignumber.js";
import { BCHHandler } from "./handlers/BCH/BCHHandler";
import { BTCHandler } from "./handlers/BTC/BTCHandler";
import { ERC20Handler } from "./handlers/ERC20/ERC20Handler";
import { ETHHandler } from "./handlers/ETH/ETHHandler";
import { FILHandler } from "./handlers/FIL/FILHandler";
import { TERRAHandler } from "./handlers/TERRA/TERRAHandler";
import { ZECHandler } from "./handlers/ZEC/ZECHandler";
import { strip0x } from "./lib/utils";
export default class CryptoAccount {
    handlers = [];
    privateKey;
    network;
    defaultAsset;
    constructorOptions;
    sharedState;
    constructor(privateKey, options) {
        this.privateKey = strip0x(Buffer.isBuffer(privateKey)
            ? privateKey.toString("hex")
            : privateKey); // Buffer.from(privateKey, "base64").toString("hex");
        this.network = (options && options.network) || "mainnet";
        this.constructorOptions = options;
        this.sharedState = {};
        this.registerHandler(BTCHandler, 0);
        this.registerHandler(ZECHandler, 10);
        this.registerHandler(BCHHandler, 20);
        this.registerHandler(ETHHandler, 30);
        this.registerHandler(FILHandler, 40);
        this.registerHandler(TERRAHandler, 50);
        this.registerHandler(ERC20Handler, 60);
        if (options && options.extraHandlers) {
            for (const handler of options.extraHandlers) {
                this.registerHandler(handler);
            }
        }
        this.defaultAsset = options && options.defaultAsset;
    }
    registerHandler = (handlerClass, priorityIn) => {
        const priority = priorityIn === undefined
            ? this.handlers.length === 0
                ? 0
                : this.handlers[this.handlers.length - 1].priority
            : priorityIn;
        const lastPosition = this.handlers.reduce((index, item, currentIndex) => item.priority <= priority ? currentIndex + 1 : index, 0);
        this.handlers.splice(lastPosition, 0, {
            handler: new handlerClass(this.privateKey, this.network, this.constructorOptions, this.sharedState),
            priority,
        });
    };
    address = async (assetIn, options) => {
        const asset = assetIn || this.defaultAsset;
        if (!asset) {
            throw new Error(`Must provide an asset`);
        }
        return this.deferHandler().address(asset, options);
    };
    getBalance = async (assetIn, options) => {
        const asset = assetIn || this.defaultAsset;
        if (!asset) {
            throw new Error(`Must provide an asset`);
        }
        const bn = await this.deferHandler().getBalance(asset, options);
        return (options && options.bn ? new options.bn(bn.toFixed()) : bn.toNumber());
    };
    // tslint:disable-next-line: member-ordering
    balanceOf = this.getBalance;
    getBalanceInSats = async (assetIn, options) => {
        const asset = assetIn || this.defaultAsset;
        if (!asset) {
            throw new Error(`Must provide an asset`);
        }
        const bn = await this.deferHandler().getBalanceInSats(asset, options);
        return (options && options.bn ? new options.bn(bn.toFixed()) : bn.toNumber());
    };
    // tslint:disable-next-line: member-ordering
    balanceOfInSats = this.getBalanceInSats;
    send = (to, value, assetIn, options) => {
        const asset = assetIn || this.defaultAsset;
        if (!asset) {
            throw new Error(`Must provide an asset`);
        }
        return this.deferHandler().send(to, new BigNumber(value.toString()), asset, options);
    };
    sendSats = (to, value, assetIn, options) => {
        const asset = assetIn || this.defaultAsset;
        if (!asset) {
            throw new Error(`Must provide an asset`);
        }
        return this.deferHandler().sendSats(to, new BigNumber(value.toString()), asset, options);
    };
    deferHandler = (thisHandler) => {
        return {
            address: (deferredAsset, deferredOptions) => {
                const nextHandler = this.findHandler(deferredAsset, thisHandler);
                if (nextHandler.address) {
                    return nextHandler.address(deferredAsset, deferredOptions || {}, this.deferHandler(nextHandler));
                }
                else {
                    return this.deferHandler(nextHandler).address(deferredAsset, deferredOptions);
                }
            },
            getBalance: (deferredAsset, deferredOptions) => {
                const nextHandler = this.findHandler(deferredAsset, thisHandler);
                if (nextHandler.getBalance) {
                    return nextHandler.getBalance(deferredAsset, deferredOptions || {}, this.deferHandler(nextHandler));
                }
                else {
                    return this.deferHandler(nextHandler).getBalance(deferredAsset, deferredOptions);
                }
            },
            getBalanceInSats: (deferredAsset, deferredOptions) => {
                const nextHandler = this.findHandler(deferredAsset, thisHandler);
                if (nextHandler.getBalanceInSats) {
                    return nextHandler.getBalanceInSats(deferredAsset, deferredOptions || {}, this.deferHandler(nextHandler));
                }
                else {
                    return this.deferHandler(nextHandler).getBalanceInSats(deferredAsset, deferredOptions);
                }
            },
            send: (deferredTo, deferredValue, deferredAsset, deferredOptions) => {
                const nextHandler = this.findHandler(deferredAsset, thisHandler);
                if (nextHandler.send) {
                    return nextHandler.send(deferredTo, deferredValue, deferredAsset, deferredOptions || {}, this.deferHandler(nextHandler));
                }
                else {
                    return this.deferHandler(nextHandler).send(deferredTo, deferredValue, deferredAsset, deferredOptions);
                }
            },
            sendSats: (deferredTo, deferredValue, deferredAsset, deferredOptions) => {
                const nextHandler = this.findHandler(deferredAsset, thisHandler);
                if (nextHandler.sendSats) {
                    return nextHandler.sendSats(deferredTo, deferredValue, deferredAsset, deferredOptions || {}, this.deferHandler(nextHandler));
                }
                else {
                    return this.deferHandler(nextHandler).sendSats(deferredTo, deferredValue, deferredAsset, deferredOptions);
                }
            },
        };
    };
    findHandler = (asset, from) => {
        const fromIndex = from
            ? this.handlers.findIndex((i) => i.handler === from)
            : -1;
        for (let i = (fromIndex === -1 ? this.handlers.length : fromIndex) - 1; i >= 0; i--) {
            const handler = this.handlers[i].handler;
            // console.log(handler);
            if (handler.handlesAsset(asset)) {
                return handler;
            }
        }
        let assetString;
        try {
            assetString = JSON.stringify(asset);
        }
        catch (error) {
            assetString = (asset && asset.name) || asset;
        }
        throw new Error(`Unsupported asset ${assetString}`);
    };
}
export const newPrivateKey = () => {
    // @ts-ignore
    try {
        // @ts-ignore
        const array = new Uint32Array(32);
        // @ts-ignore
        window.crypto.getRandomBytes(array);
        return new Buffer(array).toString("hex");
    }
    catch (error) {
        // Ignore window error.
    }
    return require("crypto").randomBytes(32).toString("hex");
};
CryptoAccount.newPrivateKey = newPrivateKey;
////////////////////////////////////////////////////////////////////////////////
// EXPORTS                                                                    //
// Based on https://github.com/MikeMcl/bignumber.js/blob/master/bignumber.js  //
////////////////////////////////////////////////////////////////////////////////
// tslint:disable: no-object-mutation
// tslint:disable-next-line: no-string-literal
CryptoAccount.default = CryptoAccount.CryptoAccount =
    CryptoAccount;
// AMD
try {
    // @ts-ignore
    if (typeof define === "function" && define.amd) {
        // @ts-ignore
        define(() => CryptoAccount);
    }
}
catch (error) {
    /* ignore */
}
// Node.js and other environments that support module.exports.
try {
    // @ts-ignore
    if (typeof module !== "undefined" && module.exports) {
        module.exports = CryptoAccount;
    }
}
catch (error) {
    /* ignore */
}
// Browser.
try {
    // @ts-ignore
    if (typeof window !== "undefined" && window) {
        // @ts-ignore
        window.CryptoAccount = CryptoAccount;
    }
}
catch (error) {
    /* ignore */
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxTQUFTLE1BQU0sY0FBYyxDQUFDO0FBRXJDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV2RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBaUJ0QyxNQUFNLENBQUMsT0FBTyxPQUFPLGFBQWE7SUFDYixRQUFRLEdBR3BCLEVBQUUsQ0FBQztJQUNTLFVBQVUsQ0FBUztJQUNuQixPQUFPLENBQVM7SUFDaEIsWUFBWSxDQUFvQjtJQUNoQyxrQkFBa0IsQ0FBaUM7SUFFNUQsV0FBVyxDQUFNO0lBRXpCLFlBQ0ksVUFBMkIsRUFDM0IsT0FBcUQ7UUFFckQsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQ3JCLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztZQUM1QixDQUFDLENBQUMsVUFBVSxDQUNuQixDQUFDLENBQUMscURBQXFEO1FBQ3hELElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLFNBQVMsQ0FBQztRQUN6RCxJQUFJLENBQUMsa0JBQWtC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